<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AJC Formation expert sys info - Option Data - Oct2024: htop coding style guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AJC Formation expert sys info - Option Data - Oct2024
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">htop coding style guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Naming conventions </h2>
<p>Names are important to convey what all those things inside the project are for. Filenames for source code traditionally used camel-case naming with the first letter written in uppercase. The file extension is always lowercase.</p>
<p>The only exceptions here are <code><a class="el" href="htop_8c.html">htop.c</a></code> and <code><a class="el" href="pcp-htop_8c.html">pcp-htop.c</a></code>, which contain the main entrance points into the code.</p>
<p>Folders for e.g. platform-specific code or complex features spawning multiple files are written in lowercase, e.g. <code>linux</code>, <code>freebsd</code>, <code>zfs</code>.</p>
<p>Inside files, the naming somewhat depends on the context. Function names should include a camel-case prefix before the actual name, separated by an underscore. While this prefix usually coincides with the module name, this is not required, yet strongly advised. One important exception to this rule are the memory management and the string utility functions from <code><a class="el" href="XUtils_8h.html">XUtils.h</a></code>.</p>
<p>Variable names inside functions should be short and precise. Using <code>i</code> for some loop counter is totally fine, using <code>someCounterValueForThisSimpleLoop</code> is not. On the other hand, when you need to hold global storage try to keep this local to your module, i.e. declare such variables <code>static</code> within the C source file. Only if your variable really needs to be visible for the whole project (which is really rare) it deserves a declaration in the header, marked <code>extern</code>.</p>
<h2>File content structure </h2>
<p>The content within each file is usually structured according to the following loose template:</p>
<ul>
<li>Copyright declaration</li>
<li>Inclusion of used headers</li>
<li>Necessary data structures and forward declarations</li>
<li>Static module-private function implementations</li>
<li>Externally visible function implementations</li>
<li>Externally visible constant structures (pseudo-OOP definitions)</li>
</ul>
<p>For header files header guards based on <code>#ifdef</code> should be used. These header guards are historically placed <b>before</b> the Copyright declaration. Stick to that for consistency please.</p>
<p>Example:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#ifndef HEADER_FILENAME</span></div><div class="line"><span class="preprocessor">#define HEADER_FILENAME</span></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment">htop - Filename.h</span></div><div class="line"><span class="comment">(C) 2021 htop dev team</span></div><div class="line"><span class="comment">Released under the GNU GPLv2+, see the COPYING file</span></div><div class="line"><span class="comment">in the source distribution for its full text.</span></div><div class="line"><span class="comment">*/</span></div></div><!-- fragment --><h2>Import and use of headers </h2>
<p>We use the GPLv2+ as a shorthand indication that we release <code>htop</code> under the GNU Public license version 2 but are totally fine with users opting to apply the "any later version" clause.</p>
<p>Every file should import headers for all symbols it's using. Thus when using a symbol from a header, even if that symbol is already imported by something else you use, you should declare an import for that header. Doing so allows for easier restructuring of the code when things need to be moved around. If you are unsure if all necessary headers are included you might use IWYU to tell you.</p>
<p>The list of includes should be the first thing in the file, after the copyright comment and be followed by two blank lines. The include list should be in the following order, with each group separated by one blank line:</p>
<ol type="1">
<li><code>include "config.h" // IWYU pragma: keep</code> if the global configuration from <code>automake</code>&amp;<code>autoconfigure</code> or any of the feature guards for C library headers (like <code>__GNU_SOURCE</code>) are required, optional otherwise. Beware of the IWYU comment.</li>
<li>Accompanying module header file (for C source files only, missing inside headers)</li>
<li>List of used system headers (non-conditional includes)</li>
<li>List of used program headers</li>
<li>Conditionally included header files, system headers first</li>
</ol>
<p>The list of headers should be sorted with includes from subdirectories following after files inside their parent directory. Thus <code>unistd.h</code> sorts before <code>sys/time.h</code>.</p>
<p>When <code><a class="el" href="XUtils_8h.html">XUtils.h</a></code> is used by the module itself or any of its included headers, the C source file must include <code>config.h</code> in the manner noted above. Failure to do so will cause a compilation error (sanity check inside <code><a class="el" href="XUtils_8h.html">XUtils.h</a></code>) or may result in other, hard-to-debug compilation issues. The include for <code>config.h</code> is only ever placed in the C source file and never in any header file. For further details see PR #1337 in our issue tracker.</p>
<h2>Symbol Exports </h2>
<p>Exports of symbols should be used sparingly. Thus unless a function you write is intended to become public API of a module you should mark it as <code>static</code>. If a function should be public API an appropriate declaration for that function has to be placed in the accompanying header file.</p>
<p>Please avoid function-like macros, in particular when exporting them in a header file. They have several downsides (re-evaluation of arguments, syntactic escapes, weak typing) for which usually a better alternative like an actual function exists. Furthermore when using function-like <code>define</code>s you may need to mark certain headers for IWYU so tracking of used symbols works.</p>
<h2>Memory Management </h2>
<p>When allocating memory make sure to free resources properly. For allocation this project uses a set of tiny wrappers around the common functions <code>malloc</code>, <code>calloc</code> and <code>realloc</code> named <code>xMalloc</code>, <code>xCalloc</code> and <code>xRealloc</code>. These functions check that memory allocation worked and error out on failure.</p>
<p>Allocation functions assert the amount of memory requested is non-zero. Trying to allocate 0 bytes of memory is an error. Please use the explicit value <code>NULL</code> in this case and handle it in your code accordingly.</p>
<p>If the allocated block of memory is intended to hold an array of values, you should use the alternate functions <code>xReallocArray</code> and <code>xReallocArrayZero</code> instead.</p>
<h2>Working with Strings </h2>
<p>It is strongly encouraged to use the functions starting with <code>String_</code> from <code><a class="el" href="XUtils_8h.html">XUtils.h</a></code> for working with zero-terminated strings as these make the API easier to use and are intended to make the intent of your code easier to grasp.</p>
<p>Thus instead of <code>!strcmp(foo, "foo")</code> it's preferred to use <code>String_eq(foo, "foo")</code> instead. While sometimes a bit more to type, this helps a lot with making the code easier to follow.</p>
<h2>Styling the code </h2>
<p>Now for the style details that can mostly be automated: Indentation, spacing and bracing. While there is no definitive code style we use, a set of rules loosely enforced has evolved.</p>
<p>Indentation in the code is done by three (3) spaces. No tabs are used. Ever.</p>
<p>Before and after keywords should be a space, e.g. <code>if (condition)</code> and <code>do { … } while (condition);</code>.</p>
<p>After opening and before closing braces a new line should be started. Content of such encoded blocks should be indented one level further than their enclosing block.</p>
<p>If a line of source code becomes too long, or when structuring it into multiple parts for clarity, the continuation line should be indented one more level than the first line it continues:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (very_long_condition &amp;&amp;</div><div class="line">   another_very_complex_expression &amp;&amp;</div><div class="line">   something_else_to_check) {</div><div class="line">   <span class="comment">// Code follows as normal ...</span></div><div class="line">} <span class="keywordflow">else</span> {</div><div class="line"></div><div class="line">}</div></div><!-- fragment --><p>Braces around simple single code statements (return, break, continue, goto, trivial assignments) are usually left out.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (answer)</div><div class="line">   <span class="keywordflow">return</span> 42;</div></div><!-- fragment --><p>If it helps readability (with several unrelated if statements in a row) or to avoid dangling-else situations braces can be added.</p>
<p>Control flow statements and the instruction making up their body should not be put on a single line, i.e. after the condition of an if statement a new line should be inserted and the body indented accordingly.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (answer)</div><div class="line">   <span class="keywordflow">return</span> 42;</div><div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (again)</div><div class="line">   <span class="keywordflow">continue</span>;</div><div class="line"><span class="keywordflow">else</span></div><div class="line">   <span class="keywordflow">break</span>;</div></div><!-- fragment --><p>When the statements that form control flow constructs are complex (e.g. more than just a simple assignment or jump) or need explanatory comments you should use braces. If any block of such a statement uses braces then all blocks of that statement must have braces too.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> ((fd = open(filename, O_RDONLY)) &gt;= 0 &amp;&amp;</div><div class="line">   (amtRead = read(buffer, <span class="keyword">sizeof</span>(buffer))) &gt; 0) {</div><div class="line">   <span class="comment">// Parse the information further ...</span></div><div class="line">   metric = handleBufferContent(buffer, amtRead);</div><div class="line">} <span class="keywordflow">else</span> {</div><div class="line">   metric = -1;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordflow">if</span> (fd &gt;= 0)</div><div class="line">   close(fd);</div></div><!-- fragment --><p>While the existing code base isn't fully consistent with this code style yet it is strongly recommended that new code follows these rules. Adapting surrounding code near places you need to touch is encouraged. Try to split off such changes into a separate, clean-up only commit to reduce noise while reviewing your changes.</p>
<p>When writing your code consistency with the surrounding codebase is favoured.</p>
<p>Don't shy away from leaving (single) blank lines to separate different groups of related statements. They can be a great asset to structure the flow of a method.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> stuff = 0;</div><div class="line"></div><div class="line"><span class="comment">// If asked for gives only half the answer ...</span></div><div class="line"><span class="keywordflow">if</span> (param)</div><div class="line">   stuff = 21;</div><div class="line"></div><div class="line"><span class="comment">// Compute the answer</span></div><div class="line">stuff %= 2;</div><div class="line">stuff *= 4;</div><div class="line">stuff *= 5;</div><div class="line">stuff += !!stuff;</div><div class="line">stuff *= 2;</div><div class="line"></div><div class="line"><span class="keywordflow">return</span> stuff;</div></div><!-- fragment --><p>If you want to automate formatting your code, the following command gives you a good baseline of how it should look:</p>
<div class="fragment"><div class="line">astyle -r -xb -s3 -p -xg -c -k1 -W1 -H \*.c \*.h</div></div><!-- fragment --><h2>Working with System APIs </h2>
<p>Please try to be considerate when using modern platform features. While they usually provide quite a performance gain or make your life easier, it is beneficial if <code>htop</code> runs on rather ancient systems. Thus when you want to use such features you should try to have an alternative available that works as a fallback.</p>
<p>An example for this are functions like <code>fstatat</code> on Linux that extend the kernel API on modern systems. But even though it has been around for over a decade you are asked to provide a POSIX alternative like emulating such calls by <code>fstat</code> if this is doable. If an alternative can not be provided you should gracefully downgrade. That could make a feature that requires this shiny API unavailable on systems that lack support for that API. Make this case visually clear to the user.</p>
<p>In general, code written for the project should be able to compile on any C99-compliant compiler.</p>
<h2>Writing documentation </h2>
<p>The primary user documentation should be the man file which you can find in <code>htop.1.in</code>.</p>
<p>Additional documentation, like this file, should be written in gh-style markdown. Make each sentence one line. Markdown will combine these in output formats. It does only insert a paragraph if you insert a blank line into the source file. This way git can better diff and present the changes when documentation is altered.</p>
<p>Documentation files reside in the <code>docs/</code> directory and have a <code>.md</code> extension.</p>
<h2>Writing pull-requests (PRs) </h2>
<p>When writing your PR or patch, the set of patches should contain the minimal changes required. Each patch in itself should ideally be self-contained and runable. The commit comment should be descriptive (<code>Updated Foo.c</code> is not), explain what the changes are and describe why they were made. While in trivial cases a short subject suffices, more complex changes might warrant a longer description and explanation of the rationale behind the changes.</p>
<p>A PR should not contain any merge commits. To follow the upstream branch of your PR rebase your work instead.</p>
<p>Avoid small commits that just fix typos that another of your commits introduced. Instead squash those changes in the appropriate commit that introduced that mistake. Git offers <code>git commit --fixup=&lt;commit&gt;</code> and <code>git rebase -i --autosquash</code> to help you with this.</p>
<p>Your final PR should contain a minimal set of reasonably sized commits that by themselves are easy to review. If you open a PR you need to follow up to resolve any comments/change requests. Otherwise it may be closed without merging.</p>
<p>Rebase early. Rebase often. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
