<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AJC Formation expert sys info - Option Data - Oct2024: Utilisation de `virtual` et du polymorphisme en C++</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AJC Formation expert sys info - Option Data - Oct2024
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Utilisation de `virtual` et du polymorphisme en C++ </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Le mot-clé <code>virtual</code> en C++ est essentiel pour permettre le <b>polymorphisme</b>, en particulier lorsqu'on travaille avec l'héritage. Il garantit que les méthodes et destructeurs appropriés des classes dérivées sont appelés, même si l'objet est référencé via un pointeur ou une référence de la classe de base.</p>
<h2>Sommaire</h2>
<ol type="1">
<li><a href="#1-pourquoi-utiliser-virtual-sur-le-destructeur">Pourquoi utiliser <code>virtual</code> sur le destructeur</a></li>
<li><a href="#2-pourquoi-utiliser-virtual-sur-certaines-méthodes">Pourquoi utiliser <code>virtual</code> sur certaines méthodes</a></li>
<li><a href="#3-exemple-complet-avec-virtual">Exemple complet avec <code>virtual</code></a></li>
<li><a href="#4-conclusion">Conclusion</a> <hr/>
</li>
</ol>
<h2>1. Pourquoi utiliser <code>virtual</code> sur le destructeur</h2>
<p>Lorsqu'un destructeur est marqué comme <code>virtual</code> dans une classe de base, cela garantit que le destructeur de la classe dérivée sera correctement appelé si un objet dérivé est détruit via un pointeur de la classe de base.</p>
<h3>Exemple de problème sans destructeur <code>virtual</code></h3>
<p>Imaginons que nous ayons une classe de base <code><a class="el" href="classCVehicule.html">CVehicule</a></code> et une classe dérivée <code><a class="el" href="classCVoiture.html">CVoiture</a></code>. Si nous détruisons un objet <code><a class="el" href="classCVoiture.html">CVoiture</a></code> via un pointeur de type <code>CVehicule*</code> sans un destructeur <code>virtual</code>, seul le destructeur de <code><a class="el" href="classCVehicule.html">CVehicule</a></code> sera appelé, et non celui de <code><a class="el" href="classCVoiture.html">CVoiture</a></code>. Cela peut entraîner des <b>fuites de mémoire</b> si <code><a class="el" href="classCVoiture.html">CVoiture</a></code> alloue dynamiquement des ressources.</p>
<div class="fragment"><div class="line"><a class="code" href="classCVehicule.html">CVehicule</a>* veh = <span class="keyword">new</span> <a class="code" href="classCVoiture.html">CVoiture</a>(<span class="stringliteral">&quot;Volvo&quot;</span>);</div><div class="line"><span class="keyword">delete</span> veh; <span class="comment">// Sans destructeur virtuel, seul CVehicule::~CVehicule() est appelé</span></div></div><!-- fragment --><h3>Solution : ajouter un destructeur <code>virtual</code></h3>
<p>En ajoutant <code>virtual</code> au destructeur de <code><a class="el" href="classCVehicule.html">CVehicule</a></code>, C++ s'assure que le destructeur de la classe dérivée <code><a class="el" href="classCVoiture.html">CVoiture</a></code> sera également appelé, libérant correctement toutes les ressources.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span><a class="code" href="classCVehicule.html">CVehicule</a> {</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keyword">virtual</span> <a class="code" href="classCVehicule.html#a149e48f61193e22310c87a418f11fcc3">~CVehicule</a>(); <span class="comment">// Destructeur virtuel</span></div><div class="line">};</div></div><!-- fragment --><h2>2. Pourquoi utiliser <code>virtual</code> sur certaines méthodes</h2>
<p>Le mot-clé <code>virtual</code> permet de définir des <b>méthodes polymorphiques</b>. En marquant une méthode comme <code>virtual</code> dans la classe de base, cela permet aux classes dérivées de redéfinir cette méthode, et garantit que la version correcte sera appelée en fonction du type réel de l'objet, même si celui-ci est manipulé via un pointeur de la classe de base.</p>
<h3>Exemple d'utilisation du polymorphisme</h3>
<p>Dans votre code, la méthode <code>afficher()</code> est redéfinie dans <code><a class="el" href="classCVoiture.html">CVoiture</a></code>. En marquant cette méthode comme <code>virtual</code> dans <code><a class="el" href="classCVehicule.html">CVehicule</a></code> et <code>override</code> dans <code><a class="el" href="classCVoiture.html">CVoiture</a></code>, on s'assure que la bonne version de <code>afficher()</code> est appelée en fonction du type réel de l'objet.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span><a class="code" href="classCVehicule.html">CVehicule</a> {</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classCVehicule.html#a7d62fa555949feb096b4f56781164895">afficher</a>() <span class="keyword">const</span>; <span class="comment">// Méthode virtuelle pour permettre le polymorphisme</span></div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">class </span><a class="code" href="classCVoiture.html">CVoiture</a> : <span class="keyword">public</span> <a class="code" href="classCVehicule.html">CVehicule</a> {</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keywordtype">void</span> <a class="code" href="classCVehicule.html#a7d62fa555949feb096b4f56781164895">afficher</a>() <span class="keyword">const override</span>; <span class="comment">// Redéfinition de la méthode afficher()</span></div><div class="line">};</div></div><!-- fragment --><h3>Exemple de polymorphisme en action</h3>
<div class="fragment"><div class="line"><a class="code" href="classCVehicule.html">CVehicule</a>* veh = <span class="keyword">new</span> <a class="code" href="classCVoiture.html">CVoiture</a>(<span class="stringliteral">&quot;Volvo&quot;</span>);</div><div class="line">veh-&gt;<a class="code" href="classCVehicule.html#a7d62fa555949feb096b4f56781164895">afficher</a>(); <span class="comment">// Appelle CVoiture::afficher() grâce au mot-clé virtual</span></div></div><!-- fragment --><p>Sans <code>virtual</code>, la méthode <code><a class="el" href="classCVehicule.html#a7d62fa555949feb096b4f56781164895">CVehicule::afficher()</a></code> serait appelée, même si <code>veh</code> pointe vers un objet de type <code><a class="el" href="classCVoiture.html">CVoiture</a></code>. Grâce à <code>virtual</code>, C++ résout l'appel à la méthode la plus spécifique possible en fonction du type de l'objet réel.</p>
<h2>3. Exemple complet avec <code>virtual</code></h2>
<p>Voici un exemple complet montrant l'importance du mot-clé <code>virtual</code> dans les destructeurs et les méthodes :</p>
<h3>Fichier <code><a class="el" href="CVehicule_8hpp.html">CVehicule.hpp</a></code></h3>
<div class="fragment"><div class="line"><span class="preprocessor">#ifndef CVEHICULE_HPP</span></div><div class="line"><span class="preprocessor">#define CVEHICULE_HPP</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">class </span><a class="code" href="classCVehicule.html">CVehicule</a> {</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <a class="code" href="classCVehicule.html#a05c0b5b9a9a96f5c6f9973e85e713d7a">CVehicule</a>(<span class="keyword">const</span> std::string&amp; <a class="code" href="classCVehicule.html#aade35613ce26b4263d09d39889604022">type</a> = <span class="stringliteral">&quot;Inconnu&quot;</span>);</div><div class="line">    <span class="keyword">virtual</span> <a class="code" href="classCVehicule.html#a149e48f61193e22310c87a418f11fcc3">~CVehicule</a>(); <span class="comment">// Destructeur virtuel</span></div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classCVehicule.html#a7d62fa555949feb096b4f56781164895">afficher</a>() <span class="keyword">const</span>; <span class="comment">// Méthode virtuelle pour polymorphisme</span></div><div class="line"></div><div class="line"><span class="keyword">protected</span>:</div><div class="line">    std::string <a class="code" href="classCVehicule.html#aade35613ce26b4263d09d39889604022">type</a>;</div><div class="line">};</div><div class="line"></div><div class="line"><span class="preprocessor">#endif</span></div></div><!-- fragment --><h3>Fichier <code><a class="el" href="CVehicule_8cpp.html">CVehicule.cpp</a></code></h3>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="CVehicule_8hpp.html">CVehicule.hpp</a>&quot;</span></div><div class="line"></div><div class="line"><a class="code" href="classCVehicule.html#a05c0b5b9a9a96f5c6f9973e85e713d7a">CVehicule::CVehicule</a>(<span class="keyword">const</span> std::string&amp; type) : type(type) {}</div><div class="line"></div><div class="line"><a class="code" href="classCVehicule.html#a149e48f61193e22310c87a418f11fcc3">CVehicule::~CVehicule</a>() {</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Destruction de CVehicule (&quot;</span> &lt;&lt; <a class="code" href="classCVehicule.html#aade35613ce26b4263d09d39889604022">type</a> &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="classCVehicule.html#a7d62fa555949feb096b4f56781164895">CVehicule::afficher</a>()<span class="keyword"> const </span>{</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Je suis un véhicule de type : &quot;</span> &lt;&lt; <a class="code" href="classCVehicule.html#aade35613ce26b4263d09d39889604022">type</a> &lt;&lt; std::endl;</div><div class="line">}</div></div><!-- fragment --><h3>Fichier <code><a class="el" href="CVoiture_8hpp.html">CVoiture.hpp</a></code></h3>
<div class="fragment"><div class="line"><span class="preprocessor">#ifndef CVOITURE_HPP</span></div><div class="line"><span class="preprocessor">#define CVOITURE_HPP</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="CVehicule_8hpp.html">CVehicule.hpp</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">class </span><a class="code" href="classCVoiture.html">CVoiture</a> : <span class="keyword">public</span> <a class="code" href="classCVehicule.html">CVehicule</a> {</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <a class="code" href="classCVoiture.html#ae37a64af5668827a9e7fd7c4e2251c04">CVoiture</a>(<span class="keyword">const</span> std::string&amp; modele);</div><div class="line">    <span class="keyword">virtual</span> <a class="code" href="classCVoiture.html#a35c99dadefbf269daba764cbe01488a1">~CVoiture</a>(); <span class="comment">// Destructeur virtuel pour garantir la destruction complète</span></div><div class="line">    <span class="keywordtype">void</span> <a class="code" href="classCVoiture.html#a0dd704fa1e172f461950f7f21a7ce21e">afficher</a>() <span class="keyword">const override</span>; <span class="comment">// Redéfinition de la méthode afficher()</span></div><div class="line"></div><div class="line"><span class="keyword">private</span>:</div><div class="line">    std::string modele;</div><div class="line">};</div><div class="line"></div><div class="line"><span class="preprocessor">#endif</span></div></div><!-- fragment --><h3>Fichier <code><a class="el" href="CVoiture_8cpp.html">CVoiture.cpp</a></code></h3>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="CVoiture_8hpp.html">CVoiture.hpp</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"></div><div class="line"><a class="code" href="classCVoiture.html#ae37a64af5668827a9e7fd7c4e2251c04">CVoiture::CVoiture</a>(<span class="keyword">const</span> std::string&amp; modele) : <a class="code" href="classCVehicule.html">CVehicule</a>(<span class="stringliteral">&quot;Voiture&quot;</span>), modele(modele) {}</div><div class="line"></div><div class="line"><a class="code" href="classCVoiture.html#a35c99dadefbf269daba764cbe01488a1">CVoiture::~CVoiture</a>() {</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Destruction de CVoiture (&quot;</span> &lt;&lt; modele &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="classCVoiture.html#a0dd704fa1e172f461950f7f21a7ce21e">CVoiture::afficher</a>()<span class="keyword"> const </span>{</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Je suis une voiture de modèle : &quot;</span> &lt;&lt; modele &lt;&lt; std::endl;</div><div class="line">}</div></div><!-- fragment --><h3>Exemple d'utilisation dans <code>main.cpp</code></h3>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="CVehicule_8hpp.html">CVehicule.hpp</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="CVoiture_8hpp.html">CVoiture.hpp</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="htop_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>() {</div><div class="line">    <a class="code" href="classCVehicule.html">CVehicule</a>* veh = <span class="keyword">new</span> <a class="code" href="classCVoiture.html">CVoiture</a>(<span class="stringliteral">&quot;Volvo&quot;</span>);</div><div class="line">    veh-&gt;<a class="code" href="classCVehicule.html#a7d62fa555949feb096b4f56781164895">afficher</a>(); <span class="comment">// Appelle CVoiture::afficher() grâce au polymorphisme</span></div><div class="line"></div><div class="line">    <span class="keyword">delete</span> veh; <span class="comment">// Appelle le destructeur de CVoiture suivi de CVehicule</span></div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><h2>4. Conclusion</h2>
<ul>
<li><b>Destructeur <code>virtual</code></b> : Assure que le destructeur de la classe dérivée est appelé lors de la suppression d'un objet via un pointeur de la classe de base. Cela permet de gérer correctement la mémoire et les ressources.</li>
<li><b>Méthodes <code>virtual</code></b> : Permet le polymorphisme, ce qui signifie que la bonne version de la méthode est appelée en fonction du type réel de l'objet, même lorsqu'il est manipulé via un pointeur de la classe de base.</li>
</ul>
<p>Le mot-clé <code>virtual</code> est essentiel pour éviter les erreurs de gestion de mémoire et pour tirer parti du polymorphisme, ce qui rend le code plus flexible et plus sûr. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
