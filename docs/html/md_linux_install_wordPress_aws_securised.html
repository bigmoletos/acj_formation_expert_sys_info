<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AJC Formation expert sys info - Option Data - Oct2024: installation du site WORDPRESS sur 2 instances aws EC2 et sur 2 instances en local</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AJC Formation expert sys info - Option Data - Oct2024
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">installation du site WORDPRESS sur 2 instances aws EC2 et sur 2 instances en local </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Installation</h1>
<p>Pour configurer l'application, utilisez les identifiants suivants : Les identifaints ci-dessous seront remplacés par les valeurs issue du fichier .env et le fichier .md sera renommé en _securised.md nom: wordpress root: 1234 mot de passe: admin utilisateur: franck</p>
<h2>AWS EC2 au niveau des instances aws groupe de securité il faut autorier SSh HTTP et MySQL/Aurora</h2>
<p>Vérifier les Groupes de Sécurité sur AWS Connectez-vous à la console AWS et accédez à EC2 &gt; Groupes de sécurité. Sélectionnez le groupe de sécurité associé à l'instance MariaDB (3.135.226.41).</p>
<p>Vérifiez les règles entrantes et assurez-vous qu'il y a une règle qui autorise les connexions entrantes sur le port 3306 :</p>
<p>Type : MySQL/Aurora Protocole : TCP Port : 3306 Source : 3.128.29.116/32 (adresse IP de l'instance WordPress) ou 0.0.0.0/0 (moins sécurisé, à n'utiliser que pour tester).</p>
<h1>Fiche d'Installation de WordPress sur Debian 12</h1>
<h2>Prérequis</h2>
<ul>
<li>Une instance Debian 12 avec les privilèges <code>sudo</code>.</li>
<li>Un nom de domaine pointant vers l'adresse IP de l'instance ou son IP publique.</li>
<li>Accès SSH à l'instance.</li>
</ul>
<p>## 1. Mise à Jour du Système </p><div class="fragment"><div class="line">sudo apt update &amp;&amp; sudo apt upgrade -y</div><div class="line"></div><div class="line">sudo apt install build-essential libncursesw5-dev libncurses-dev autoconf autoconf-archive automake make pkgconf m4 build-essential gdb lcov pkg-config   libbz2-dev libffi-dev libgdbm-dev libgdbm-compat-dev liblzma-dev   libncurses5-dev libreadline6-dev libsqlite3-dev libssl-dev  lzma lzma-dev tk-dev uuid-dev zlib1g-dev unzip apache2 ssh ufw htop dos2unix -y</div></div><!-- fragment --><h2>2. Installation de LAMP (Linux, Apache, MySQL, PHP)</h2>
<p>### 2.1. Installer Apache </p><div class="fragment"><div class="line">sudo apt install apache2 -y</div><div class="line">sudo systemctl start apache2</div><div class="line">sudo systemctl enable apache2</div><div class="line"></div><div class="line">sudo systemctl status apache2</div></div><!-- fragment --><h3>Installer MariaDB (MySQL)</h3>
<div class="fragment"><div class="line">sudo apt install mariadb-server -y</div><div class="line">sudo systemctl start mariadb</div><div class="line">sudo systemctl enable mariadb</div></div><!-- fragment --><h3>Sécuriser l'Installation de MariaDB</h3>
<div class="fragment"><div class="line">sudo mysql_secure_installation</div></div><!-- fragment --><p>NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB SERVERS IN PRODUCTION USE! PLEASE READ EACH STEP CAREFULLY!</p>
<p>In order to log into MariaDB to secure it, we'll need the current password for the root user. If you've just installed MariaDB, and haven't set the root password yet, you should just press enter here.</p>
<p>Enter current password for root (enter for none): OK, successfully used password, moving on...</p>
<p>Setting the root password or using the unix_socket ensures that nobody can log into the MariaDB root user without the proper authorisation.</p>
<p>You already have your root account protected, so you can safely answer 'n'.</p>
<p>Switch to unix_socket authentication [Y/n] y Enabled successfully! Reloading privilege tables.. ... Success!</p>
<p>You already have your root account protected, so you can safely answer 'n'.</p>
<p>Change the root password? [Y/n] y New password: Re-enter new password: Sorry, you can't use an empty password here.</p>
<p>New password: Re-enter new password: Password updated successfully! Reloading privilege tables.. ... Success!</p>
<p>By default, a MariaDB installation has an anonymous user, allowing anyone to log into MariaDB without having to have a user account created for them. This is intended only for testing, and to make the installation go a bit smoother. You should remove them before moving into a production environment.</p>
<p>Remove anonymous users? [Y/n] n ... skipping. Normally, root should only be allowed to connect from 'localhost'. This ensures that someone cannot guess at the root password from the network. Disallow root login remotely? [Y/n] n ... skipping.</p>
<p>By default, MariaDB comes with a database named 'test' that anyone can access. This is also intended only for testing, and should be removed before moving into a production environment.</p>
<p>Remove test database and access to it? [Y/n] n ... skipping.</p>
<p>Reloading the privilege tables will ensure that all changes made so far will take effect immediately.</p>
<p>Reload privilege tables now? [Y/n] y ... Success!</p>
<p>Cleaning up...</p>
<p>All done! If you've completed all of the above steps, your MariaDB installation should now be secure.</p>
<p>Thanks for using MariaDB!</p>
<h2>2.4. Créer la Base de Données WordPress</h2>
<div class="fragment"><div class="line">sudo mysql -u root -p</div></div><!-- fragment --><div class="fragment"><div class="line">CREATE DATABASE wordpress;</div><div class="line">CREATE USER &#39;franck&#39;@&#39;%&#39; IDENTIFIED BY &#39;xxxxxxxxxxxxxxx&#39;;</div><div class="line">GRANT ALL PRIVILEGES ON wordpress.* TO &#39;franck&#39;@&#39;%&#39;;</div><div class="line">FLUSH PRIVILEGES;</div><div class="line">EXIT;</div></div><!-- fragment --><p>#### pour tester </p><div class="fragment"><div class="line">sudo mysql -u root -p</div><div class="line">GRANT ALL PRIVILEGES ON wordpress.* TO &#39;franck&#39;@&#39;%&#39; IDENTIFIED BY &#39;xxxxxxxxxxxxxxx&#39;;</div><div class="line">FLUSH PRIVILEGES;</div><div class="line">exit;</div></div><!-- fragment --> <h2>Installer PHP et les Extensions Nécessaires</h2>
<div class="fragment"><div class="line">sudo apt install php libapache2-mod-php php-mysql php-xml php-gd php-curl php-mbstring php-xmlrpc php-soap php-intl php-zip unzip -y</div></div><!-- fragment --><h2>Téléchargement de WordPress</h2>
<div class="fragment"><div class="line">cd /var/www/html/</div><div class="line">sudo wget https://wordpress.org/latest.zip</div><div class="line">sudo unzip latest.zip</div><div class="line">sudo mv wordpress/* /var/www/html/</div><div class="line">sudo chown -R www-data:www-data /var/www/html/</div><div class="line">sudo chmod -R 755 /var/www/html/</div></div><!-- fragment --><h2>Configurer WordPress</h2>
<div class="fragment"><div class="line">sudo mv /var/www/html/wp-config-sample.php /var/www/html/wp-config.php</div></div><!-- fragment --><p>### Modifiez le fichier de configuration WordPress : </p><div class="fragment"><div class="line">sudo nano /var/www/html/wp-config.php</div><div class="line"></div><div class="line">#// ** Database settings - You can get this info from your web host ** //</div><div class="line">#/** The name of the database for WordPress */</div><div class="line">define( &#39;DB_NAME&#39;, $DEBIAN_NAME );</div><div class="line"></div><div class="line">#/** Database username */</div><div class="line">define( &#39;DB_USER&#39;, &#39;franck&#39; );</div><div class="line"></div><div class="line">#/** Database password */</div><div class="line">define( &#39;DB_PASSWORD&#39;, &#39;xxxxxxx&#39; );</div><div class="line"></div><div class="line">#/** Database hostname */</div><div class="line">define( &#39;DB_HOST&#39;, &#39;3.135.226.41&#39; );</div><div class="line"></div><div class="line">#/** Database charset to use in creating database tables. */</div><div class="line">define( &#39;DB_CHARSET&#39;, &#39;utf8&#39; );</div><div class="line"></div><div class="line">#/** The database collate type. Don&#39;t change this if in doubt. */</div><div class="line">define( &#39;DB_COLLATE&#39;, &#39;&#39; );</div></div><!-- fragment --><h2>Configurer Apache pour WordPress</h2>
<p>### Créez un nouveau fichier de configuration pour le site WordPress et Ajoutez la configuration suivante : </p><div class="fragment"><div class="line">sudo nano /etc/apache2/sites-available/wordpress.conf</div><div class="line"></div><div class="line">&lt;VirtualHost *:80&gt;</div><div class="line">    ServerName 3.128.29.116</div><div class="line">    DocumentRoot /var/www/html/</div><div class="line"></div><div class="line">    &lt;Directory /var/www/html/&gt;</div><div class="line">        AllowOverride All</div><div class="line">    &lt;/Directory&gt;</div><div class="line"></div><div class="line">    ErrorLog ${APACHE_LOG_DIR}/error.log</div><div class="line">    CustomLog ${APACHE_LOG_DIR}/access.log combined</div><div class="line">&lt;/VirtualHost&gt;</div></div><!-- fragment --><div class="fragment"><div class="line">sudo nano /etc/mysql/mariadb.conf.d/50-server.cnf</div><div class="line">remplacer</div><div class="line">bind-address            = 127.0.0.1</div><div class="line">par</div><div class="line">bind-address            = 0.0.0.0</div></div><!-- fragment --><h3>Activez la configuration du site et le module rewrite :</h3>
<div class="fragment"><div class="line">sudo nano /etc/apache2/apache2.conf</div><div class="line"></div><div class="line">### à la fin du fichier il faut rajouter</div><div class="line">ServerName 3.128.29.116</div></div><!-- fragment --><div class="fragment"><div class="line">sudo a2ensite wordpress.conf</div><div class="line">sudo a2enmod rewrite</div></div><!-- fragment --><p>### Vérifiez la syntaxe Apache et redémarrez le service : </p><div class="fragment"><div class="line">sudo apache2ctl configtest</div><div class="line">sudo systemctl reload apache2</div></div><!-- fragment --><h2>verfication du parfeu</h2>
<div class="fragment"><div class="line">sudo apt install ufw -y</div><div class="line">sudo ufw status</div><div class="line"># pour autiser le port par defaut 3306</div><div class="line">sudo ufw allow from 3.128.29.116 to any port 3306</div><div class="line"></div><div class="line"># Pour tester, vous pouvez désactiver temporairement ufw :</div><div class="line">sudo ufw disable</div></div><!-- fragment --><h2>pour relancer le serveur mariaDb</h2>
<div class="fragment"><div class="line">sudo systemctl start mariadb</div><div class="line">sudo systemctl enable mariadb</div></div><!-- fragment --><h2>pour relancer le serveur Web</h2>
<div class="fragment"><div class="line">sudo systemctl start apache2</div><div class="line">sudo systemctl enable apache2</div></div><!-- fragment --><p>### Pour voir les tables mariadb et les users </p><div class="fragment"><div class="line">sudo mysql -u root -p</div><div class="line"></div><div class="line">SHOW DATABASES;</div><div class="line">SELECT User, Host FROM mysql.user;</div><div class="line">SHOW GRANTS FOR &#39;franck&#39;@&#39;%&#39;;</div></div><!-- fragment --><h3>pour changer le mot de passe du user de la Bdd</h3>
<div class="fragment"><div class="line">sudo mysql -u root -p</div><div class="line">ALTER USER &#39;franck&#39;@&#39;%&#39; IDENTIFIED BY &#39;xxxxxxxxxxxxxxx&#39;;</div><div class="line">FLUSH PRIVILEGES;</div><div class="line">EXIT;</div><div class="line"></div><div class="line">CREATE USER &#39;franck&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;xxxxxxxxxxxxxxx&#39;;</div><div class="line">ALTER USER &#39;wordpress&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;xxxxxxxxxxxxxxx&#39;;</div><div class="line">GRANT ALL PRIVILEGES ON wordpress.* TO &#39;franck&#39;@&#39;%&#39; IDENTIFIED BY &#39;xxxxxxxxxxxxxxx&#39;;</div><div class="line">FLUSH PRIVILEGES;</div><div class="line">EXIT;</div><div class="line"></div><div class="line">### pour autoriser toutes les ip et pas que le localhost</div><div class="line">EXIT;</div><div class="line">CREATE USER &#39;franck&#39;@&#39;%&#39; IDENTIFIED BY &#39;xxxxxxxxxxxxxxx&#39;;</div></div><!-- fragment --><h3>pour tester l'acces à l'instance de la BDD de puis celle du site wordpress il faut installer un client mariadb dessus</h3>
<div class="fragment"><div class="line">sudo apt install mariadb-client -y</div><div class="line">mysql -h 3.135.226.41 -P 3306 -u franck -p</div></div><!-- fragment --><h1>acceder à la vm aws franckBDD depuis une Vm locale et non aws on peut creer un tunnel ssh</h1>
<div class="fragment"><div class="line">ssh -i  C:/AJC_formation/linux/doc/debian12/keyfranck2.pem  -L 3306:localhost:3306 franck@3.135.226.41</div><div class="line">mkdir -p ~/.ssh</div><div class="line">cp /path/to/keyfile.pem ~/.ssh/</div><div class="line">chmod 600 ~/.ssh/keyfile.pem</div><div class="line">chmod 700 ~/.ssh</div><div class="line"></div><div class="line"># avant il faut copier la clé pem sur l&#39;instance dans un dossier .ssh</div><div class="line"></div><div class="line">~/.ssh/</div><div class="line"></div><div class="line">ssh -i ~/.ssh/keyfranck2.pem -L 3306:localhost:3306 franck@3.135.226.41</div></div><!-- fragment --><h2>instance wordpress locale bdd sur 192.168.1.189, instance site wordpress 192.168.1.188</h2>
<div class="fragment"><div class="line">USE wordpress;</div><div class="line">SELECT option_name, option_value FROM wp_options WHERE option_name IN (&#39;siteurl&#39;, &#39;home&#39;);</div><div class="line">UPDATE wp_options SET option_value = &#39;http://192.168.1.188:9500&#39; WHERE option_name = &#39;siteurl&#39; OR option_name = &#39;home&#39;;</div><div class="line"></div><div class="line"># Pour tester le site en local:</div><div class="line">http://192.168.1.188:9500/wp-admin/install.php</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
